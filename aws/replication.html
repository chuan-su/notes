<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Data Replication</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Chuan's Notes</a></li><li class="chapter-item expanded "><a href="../java/index.html"><strong aria-hidden="true">1.</strong> Java</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../java/reduce.html"><strong aria-hidden="true">1.1.</strong> reduce</a></li><li class="chapter-item expanded "><a href="../java/foldleft.html"><strong aria-hidden="true">1.2.</strong> foldleft</a></li></ol></li><li class="chapter-item expanded "><a href="../docker/index.html"><strong aria-hidden="true">2.</strong> Docker</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../docker/dockerfile.html"><strong aria-hidden="true">2.1.</strong> Dockerfile</a></li><li class="chapter-item expanded "><a href="../docker/volume.html"><strong aria-hidden="true">2.2.</strong> volume</a></li><li class="chapter-item expanded "><a href="../docker/network.html"><strong aria-hidden="true">2.3.</strong> network</a></li><li class="chapter-item expanded "><a href="../docker/dockerrun.html"><strong aria-hidden="true">2.4.</strong> docker run</a></li></ol></li><li class="chapter-item expanded "><a href="../linux/index.html"><strong aria-hidden="true">3.</strong> Linux</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../linux/volume.html"><strong aria-hidden="true">3.1.</strong> Volume</a></li><li class="chapter-item expanded "><a href="../linux/void.html"><strong aria-hidden="true">3.2.</strong> Void Linux</a></li><li class="chapter-item expanded "><a href="../linux/netcat.html"><strong aria-hidden="true">3.3.</strong> netcat</a></li></ol></li><li class="chapter-item expanded "><a href="../aws/index.html"><strong aria-hidden="true">4.</strong> AWS</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../aws/ebs.html"><strong aria-hidden="true">4.1.</strong> EBS</a></li><li class="chapter-item expanded "><a href="../aws/ec2.html"><strong aria-hidden="true">4.2.</strong> EC2</a></li><li class="chapter-item expanded "><a href="../aws/iam.html"><strong aria-hidden="true">4.3.</strong> IAM</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../aws/iamrole.html"><strong aria-hidden="true">4.3.1.</strong> IAM Role</a></li></ol></li><li class="chapter-item expanded "><a href="../aws/kms.html"><strong aria-hidden="true">4.4.</strong> KMS</a></li><li class="chapter-item expanded "><a href="../aws/vpc.html"><strong aria-hidden="true">4.5.</strong> VPC</a></li><li class="chapter-item expanded "><a href="../aws/elb.html"><strong aria-hidden="true">4.6.</strong> ELB</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../aws/auto-scaling.html"><strong aria-hidden="true">4.6.1.</strong> Auto Scaling</a></li></ol></li><li class="chapter-item expanded "><a href="../aws/route53.html"><strong aria-hidden="true">4.7.</strong> Route 53</a></li><li class="chapter-item expanded "><a href="../aws/global-accelerator.html"><strong aria-hidden="true">4.8.</strong> Global Accelerator</a></li><li class="chapter-item expanded "><a href="../aws/cloudfront.html"><strong aria-hidden="true">4.9.</strong> CloudFront</a></li><li class="chapter-item expanded "><a href="../aws/lambda.html"><strong aria-hidden="true">4.10.</strong> Lambda</a></li><li class="chapter-item expanded "><a href="../aws/s3.html"><strong aria-hidden="true">4.11.</strong> S3</a></li><li class="chapter-item expanded "><a href="../aws/replication.html" class="active"><strong aria-hidden="true">4.12.</strong> Data Replication</a></li><li class="chapter-item expanded "><a href="../aws/elasticache.html"><strong aria-hidden="true">4.13.</strong> ElastiCache</a></li><li class="chapter-item expanded "><a href="../aws/security.html"><strong aria-hidden="true">4.14.</strong> Security</a></li><li class="chapter-item expanded "><a href="../aws/misc.html"><strong aria-hidden="true">4.15.</strong> Misc</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="replication--backups"><a class="header" href="#replication--backups">Replication &amp; Backups</a></h1>
<h3 id="s3"><a class="header" href="#s3">S3</a></h3>
<p>All S3 storage classes except <code>One Zone-Infrequent Access</code> distribute objects across multiple
availability zones.</p>
<p>You can also enable cross-region replication between a source bucket in one region and destination bucket in another.
Note that cross-region replication requires versioning to be enabled on both buckets. Note that cross-region replication does not apply to existing objects. Also, if the source bucket get deleted,the target bucket is NOT deleted. For replicating object deletion, you can <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/delete-marker-replication.html">enable delete marker replication</a></p>
<p>In addtion to <a href="https://aws.amazon.com/about-aws/whats-new/2018/11/s3-intelligent-tiering/">S3 Intelligent Tier Storage</a> that moves objects that have not been accessed for 30 consecutive days to the infrequent access tier. You can also manually configure <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/object-lifecycle-mgmt.html">lifecycle rules</a> for a bucket that will automatically transition an objectâ€™s storage class after a set number of days. </p>
<p>Read more about <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/replication.html#crr-scenario">Replicating objects</a>.</p>
<h3 id="ebs-volume"><a class="header" href="#ebs-volume">EBS Volume</a></h3>
<p>EBS automatically replicates volumes across multiple availability zones in a region.</p>
<p>You can use <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/snapshot-lifecycle.html">Amazon Data Lifecycle Manager</a> to automatically create a snapshot for you at regular intervals. To use the Amazon Data Lifecycle Manager, you create a Snapshot Lifecycle Policy and specify an interval of up to 24 hours, as well as a snapshot creation time. You also must specify the number of automatic snapshots to retain, up to 1,000
snapshots. You can also enable <code>cross-region</code> copy and cross-account sharing.</p>
<h3 id="efs"><a class="header" href="#efs">EFS</a></h3>
<p>EFS filesystems are stored across multiple zones in a region.</p>
<p>To protect against data loss and corruption, you can back up individual files to an S3 bucket or another EFS filesystem in the same region. 
You can also use the <a href="https://docs.aws.amazon.com/efs/latest/ug/awsbackup.html">AWS Backup Service</a> to schedule incremental backups of your EFS filesystem</p>
<h3 id="dynamodb"><a class="header" href="#dynamodb">DynamoDB</a></h3>
<p>DynamoDB stores tables across multiple availability zones.
To replicate DynamoDB table to different region, you can use <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/GlobalTables.html">DynamoDB global tables</a>. </p>
<p>You can also configure point-in-time recovery to automatically take backups of your DynamoDB tables.
Point-in-time recovery lets you restore your DynamoDB tables to any point in time from 35 days until 5 minutes before the current time.</p>
<h3 id="rds"><a class="header" href="#rds">RDS</a></h3>
<h4 id="multi-az-deployments"><a class="header" href="#multi-az-deployments">Multi-AZ Deployments</a></h4>
<p>Multi-AZ deployment provides a <em>standby database instance</em> in a different availibity zone that the <em>primary database</em> instance resides.</p>
<p>RDS synchronously replicates data from the primary to the standby instance. And if the primray instance experiences an outage, it will fail over to the standby instance. </p>
<p><strong>Note that</strong> in the multi-AZ deployment, all instances resides in the same region. And the standby instance is not a read replica and cannot serve read traffic. And you can't directly connect to the standby instance. This is only used in the event of a database failover when your primary instance encountered an outage</p>
<h4 id="read-replica"><a class="header" href="#read-replica">Read Replica</a></h4>
<p>With Amazon RDS, you can create a read replica of the primary database instance in a different AZ even different region.
However, creating a cross-region read replica isn't supported for SQL Server on Amazon RDS.</p>
<p>When creating a read replica, you must enable automatic backups on the source DB instance by setting the backup retention period to
a value other than 0.</p>
<p>You can have up to 5 replicas and each read replica will have its own DNS endpoint.</p>
<p>Replicas can be promoted to their own standalone database, but this breaks the replication. 
Moreover, no automatic failover, if primary database fails you must manually update urls to point at the newly promoted database.</p>
<h5 id="compare"><a class="header" href="#compare">Compare</a></h5>
<table><thead><tr><th align="left">Mutil-AZ Deployments</th><th align="left">Read Replicas</th></tr></thead><tbody>
<tr><td align="left">Synchronous replication - highly durable</td><td align="left">Asynchronous replication - highly scalable</td></tr>
<tr><td align="left">Only database engine on primary instance is active</td><td align="left">All read replicas are accessible and can be used for read scaling</td></tr>
<tr><td align="left">Automated backups are taken from standby instance</td><td align="left">No backups configured by default</td></tr>
<tr><td align="left">Always span at least 2 Availability Zones within a single region</td><td align="left">Can be within Availability Zone, Cross-AZ, or Cross-Region</td></tr>
<tr><td align="left">Database engine version upgrades happen on primary instance</td><td align="left">Database engine version upgrade is independent from source instance</td></tr>
<tr><td align="left">Automatic failover to standby when a problem is detected</td><td align="left">can be manually promoted to a standalone database instance</td></tr>
</tbody></table>
<h4 id="point-in-time-recovery"><a class="header" href="#point-in-time-recovery">Point-in-time recovery</a></h4>
<p>Enabling automatic backups enables point-in-time recovery, which archives database change logs to S3 every 5 minutes.</p>
<p>RDS keeps automated snapshots for a limited period of time and then deletes them. You can choose a retention period between one day and 35 days. 
The default is seven days. To disable automated snapshots, set the retention period to 0. </p>
<p>Note that disabling automated snapshots immediately deletes all existing automated snapshots and disables point-in-time recovery. Also, if you change the retention period from 0 to any other value, it will trigger an immediate snapshot.</p>
<p>Reference</p>
<ul>
<li><a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_ReadRepl.html">Working with read replicas</a></li>
<li><a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_ReadRepl.XRgn.html">Cross-region read replicas</a></li>
<li><a href="https://aws.amazon.com/rds/features/read-replicas/">Read replicas, Mutil-AZ deployments, and multi-region deployments</a></li>
</ul>
<h3 id="aurora"><a class="header" href="#aurora">Aurora</a></h3>
<ul>
<li><a href="https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/Aurora.Overview.html">Aurora DB cluster</a></li>
<li><a href="https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/Aurora.Overview.Endpoints.html">Aurora Connection</a></li>
<li><a href="https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/Aurora.Replication.html">Aurora Replication</a></li>
</ul>
<h3 id="redshift"><a class="header" href="#redshift">Redshift</a></h3>
<p>Snapshots are point-in-time backups of a cluster. There are two types of snapshots: automated and manual. Amazon Redshift stores these snapshots internally in Amazon S3 by using an encrypted Secure Sockets Layer (SSL) connection. </p>
<p>When automated snapshots are enabled for a cluster, Amazon Redshift periodically takes snapshots of that cluster. By default Amazon Redshift takes a snapshot about every eight hours or following every 5 GB per node of data changes, or whichever comes first. </p>
<p>You can configure Amazon Redshift to automatically copy snapshots (automated or manual) for a cluster to another AWS Region. When a snapshot is created in the cluster's primary AWS Region, it's copied to a secondary AWS Region.</p>
<p>Reference</p>
<ul>
<li><a href="https://docs.aws.amazon.com/redshift/latest/mgmt/working-with-snapshots.html#working-with-snapshots-overview">https://docs.aws.amazon.com/redshift/latest/mgmt/working-with-snapshots.html#working-with-snapshots-overview</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../aws/s3.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../aws/elasticache.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../aws/s3.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../aws/elasticache.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
