<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>VPC</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../index.html">Chuan's Notes</a></li><li class="chapter-item "><a href="../java/index.html"><strong aria-hidden="true">1.</strong> Java</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../java/reduce.html"><strong aria-hidden="true">1.1.</strong> reduce</a></li><li class="chapter-item "><a href="../java/foldleft.html"><strong aria-hidden="true">1.2.</strong> foldleft</a></li><li class="chapter-item "><a href="../java/spring-actuator.html"><strong aria-hidden="true">1.3.</strong> Spring Actuator</a></li><li class="chapter-item "><a href="../java/swagger.html"><strong aria-hidden="true">1.4.</strong> Swagger</a></li><li class="chapter-item "><a href="../java/freemarker.html"><strong aria-hidden="true">1.5.</strong> FreeMarker</a></li></ol></li><li class="chapter-item "><a href="../docker/index.html"><strong aria-hidden="true">2.</strong> Docker</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../docker/dockerfile.html"><strong aria-hidden="true">2.1.</strong> Dockerfile</a></li><li class="chapter-item "><a href="../docker/volume.html"><strong aria-hidden="true">2.2.</strong> volume</a></li><li class="chapter-item "><a href="../docker/network.html"><strong aria-hidden="true">2.3.</strong> network</a></li><li class="chapter-item "><a href="../docker/dockerrun.html"><strong aria-hidden="true">2.4.</strong> docker run</a></li></ol></li><li class="chapter-item "><a href="../linux/index.html"><strong aria-hidden="true">3.</strong> Linux</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../linux/volume.html"><strong aria-hidden="true">3.1.</strong> Volume</a></li><li class="chapter-item "><a href="../linux/void.html"><strong aria-hidden="true">3.2.</strong> Void Linux</a></li><li class="chapter-item "><a href="../linux/netcat.html"><strong aria-hidden="true">3.3.</strong> netcat</a></li></ol></li><li class="chapter-item expanded "><a href="../aws/index.html"><strong aria-hidden="true">4.</strong> AWS</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../aws/ebs.html"><strong aria-hidden="true">4.1.</strong> EBS</a></li><li class="chapter-item "><a href="../aws/ec2.html"><strong aria-hidden="true">4.2.</strong> EC2</a></li><li class="chapter-item "><a href="../aws/iam.html"><strong aria-hidden="true">4.3.</strong> IAM</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../aws/iamrole.html"><strong aria-hidden="true">4.3.1.</strong> IAM Role</a></li></ol></li><li class="chapter-item "><a href="../aws/kms.html"><strong aria-hidden="true">4.4.</strong> KMS</a></li><li class="chapter-item expanded "><a href="../aws/vpc.html" class="active"><strong aria-hidden="true">4.5.</strong> VPC</a></li><li class="chapter-item "><a href="../aws/elb.html"><strong aria-hidden="true">4.6.</strong> ELB</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../aws/auto-scaling.html"><strong aria-hidden="true">4.6.1.</strong> Auto Scaling</a></li></ol></li><li class="chapter-item "><a href="../aws/route53.html"><strong aria-hidden="true">4.7.</strong> Route 53</a></li><li class="chapter-item "><a href="../aws/global-accelerator.html"><strong aria-hidden="true">4.8.</strong> Global Accelerator</a></li><li class="chapter-item "><a href="../aws/cloudfront.html"><strong aria-hidden="true">4.9.</strong> CloudFront</a></li><li class="chapter-item "><a href="../aws/lambda.html"><strong aria-hidden="true">4.10.</strong> Lambda</a></li><li class="chapter-item "><a href="../aws/s3.html"><strong aria-hidden="true">4.11.</strong> S3</a></li><li class="chapter-item "><a href="../aws/replication.html"><strong aria-hidden="true">4.12.</strong> Data Replication</a></li><li class="chapter-item "><a href="../aws/elasticache.html"><strong aria-hidden="true">4.13.</strong> ElastiCache</a></li><li class="chapter-item "><a href="../aws/security.html"><strong aria-hidden="true">4.14.</strong> Security</a></li><li class="chapter-item "><a href="../aws/misc.html"><strong aria-hidden="true">4.15.</strong> Misc</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="vpc"><a class="header" href="#vpc">VPC</a></h1>
<p><img src="../img/aws-vpc.svg" alt="vpc" /></p>
<h2 id="subnets"><a class="header" href="#subnets">Subnets</a></h2>
<p>VPC CIDR: 172.16.0.0/16</p>
<p>Given a subnet CIDR within the VPC, as follows:</p>
<p>172.16.17.30/20</p>
<p>10101100.00010000.<strong>0001</strong>0001.00011110</p>
<p>The next non-overlaping CIDR (subnet) is to keep the first 16 bits of VPC CIDR prefix and only modify the next 4 bits that are highlighted. And we get the next subnet CIDR within the VPC:</p>
<p>172.16.33.30/20</p>
<p>10101100.00010000.<strong>0010</strong>0001.00011110</p>
<p>To get an IP address within a subnet, modify the bits other than the 20 bits of subnet CIDR prefix:</p>
<p>172.16.32.31 </p>
<p>10101100.00010000.0010<strong>0000.00011111</strong></p>
<h2 id="vpc-endpoint"><a class="header" href="#vpc-endpoint">VPC endpoint</a></h2>
<p>A <a href="https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints.html">VPC endpoint</a> enables private connections <strong>between your VPC and supported AWS services</strong> and <a href="https://docs.aws.amazon.com/vpc/latest/privatelink/endpoint-service.html">VPC endpoint services</a> powered by AWS PrivateLink.</p>
<p>A VPC endpoint does not require an internet gateway, virtual private gateway, NAT device, VPN connection, or AWS Direct Connect connection. Instances in your VPC do not require public IP addresses to communicate with resources in the service. </p>
<p>One usecase of VPC endpoint is to <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/vpc-endpoints.html">create VPC endpoints for Amazon ECS</a></p>
<p>When you create a VPC endpoint, you can attach an endpoint policy that controls access to the service to which you are connecting.</p>
<h3 id="gateway-endpoint"><a class="header" href="#gateway-endpoint">Gateway endpoint</a></h3>
<ul>
<li>Endpoint connections cannot be extended out of a VPC. Resources on the other side of a VPN connection, VPC peering connection, transit gateway, AWS Direct Connect connection, or ClassicLink connection in your VPC cannot use the endpoint to communicate with resources in the endpoint service. </li>
<li>Endpoints are supported within the same Region only. You cannot create an endpoint between a VPC and a service in a different Region. </li>
<li>You must turn on DNS resolution in your VPC</li>
</ul>
<h4 id="vpc-endpoint-service"><a class="header" href="#vpc-endpoint-service">VPC endpoint service</a></h4>
<ul>
<li><a href="https://docs.aws.amazon.com/vpc/latest/privatelink/endpoint-service-overview.html">VPC endpoint serices (AWS PrivateLink</a></li>
</ul>
<h3 id="vpc-link"><a class="header" href="#vpc-link">VPC Link</a></h3>
<p>You can create an <code>API Gateway API</code> with private integration to provide your customers access to HTTP/HTTPS resources within your Amazon VPC.</p>
<p>Such VPC resources are HTTP/HTTPS endpoints on an EC2 instance behind a <code>Network Load Balancer</code> in the VPC. The Network Load Balancer encapsulates the VPC resource and routes incoming requests to the targeted resource. </p>
<ul>
<li><a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/set-up-api-with-vpclink-console.html">API Gateway privat integration</a></li>
<li><a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/getting-started-with-private-integration.html">Tutorial: Build a REST API with API Gateway private integration</a></li>
</ul>
<h2 id="multi-vpc-network-infrastructure"><a class="header" href="#multi-vpc-network-infrastructure">Multi-VPC Network Infrastructure</a></h2>
<h3 id="vpc-peering"><a class="header" href="#vpc-peering">VPC Peering</a></h3>
<p>if VPC A and VPC B are peered, and VPC A has any of these connections:</p>
<ul>
<li>A VPN connection or an AWS Direct Connect connection to a corporate network</li>
<li>An internet connection through an internet gateway</li>
<li>An internet connection in a private subnet through a NAT device</li>
<li>A gateway VPC endpoint to an AWS service; for example, an endpoint to Amazon S3. </li>
</ul>
<p>then instances in VPC B cannot use the connection to access resources on the other side of the connection. </p>
<h3 id="transive-gateway"><a class="header" href="#transive-gateway">Transive Gateway</a></h3>
<ul>
<li><a href="https://docs.aws.amazon.com/whitepapers/latest/building-scalable-secure-multi-vpc-network-infrastructure/welcome.html">Whitepaper: Building a Scalable and Secure Multi-VPC AWS Network Infrastructure</a></li>
<li><a href="https://docs.aws.amazon.com/whitepapers/latest/building-scalable-secure-multi-vpc-network-infrastructure/centralized-egress-to-internet.html">Centralized egress to Internet</a></li>
<li><a href="https://aws.amazon.com/blogs/networking-and-content-delivery/creating-a-single-internet-exit-point-from-multiple-vpcs-using-aws-transit-gateway/">Creating a single internet exit point from multiple VPCs Using AWS Transit Gateway</a></li>
<li><a href="https://www.gilles.cloud/2020/10/egress-vpc-and-aws-transit-gateway.html">Egress VPC</a></li>
</ul>
<h1 id="hybrid-cloud"><a class="header" href="#hybrid-cloud">Hybrid Cloud</a></h1>
<p><img src="https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2020/02/02/Multiple-Tunnels.png" alt="EMCP Enabled Transit Gateway" /></p>
<p>AWS Transit Gateway also enables you to scale the IPsec VPN throughput with equal-cost multi-path (ECMP) routing support over multiple VPN tunnels. A single VPN tunnel still has a maximum throughput of 1.25 Gbps. If you establish multiple VPN tunnels to an ECMP-enabled transit gateway, it can scale beyond the default limit of 1.25 Gbps.</p>
<ul>
<li><a href="https://docs.aws.amazon.com/vpn/latest/s2svpn/vpn-redundant-connection.html">AWS Site-to-Site VPN</a></li>
<li><a href="https://docs.aws.amazon.com/directconnect/latest/UserGuide/lags.html">Direct Connect</a></li>
<li><a href="https://d1.awsstatic.com/whitepapers/aws-amazon-vpc-connectivity-options.pdf">Whitepaper: AWS VPC Connectivity Options</a></li>
<li><a href="https://aws.amazon.com/premiumsupport/knowledge-center/transit-gateway-ecmp-multiple-tunnels/">https://aws.amazon.com/premiumsupport/knowledge-center/transit-gateway-ecmp-multiple-tunnels/</a></li>
<li><a href="https://aws.amazon.com/blogs/aws/new-vpc-traffic-mirroring/">https://aws.amazon.com/blogs/aws/new-vpc-traffic-mirroring/</a></li>
</ul>
<h3 id="read-more"><a class="header" href="#read-more">Read More</a></h3>
<ul>
<li><a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Subnets.html">https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Subnets.html</a></li>
<li><a href="https://www.cisco.com/c/en/us/support/docs/ip/routing-information-protocol-rip/13788-3.html">https://www.cisco.com/c/en/us/support/docs/ip/routing-information-protocol-rip/13788-3.html</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../aws/kms.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../aws/elb.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../aws/kms.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../aws/elb.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
